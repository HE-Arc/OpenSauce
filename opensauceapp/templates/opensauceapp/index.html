{% extends 'opensauceapp/base.html' %}
{% block title %}Home{% endblock %}

{% load static %}

{% block content %}
<div class="container">
	<p class="text-center opensaucetitle">OpenSauce</p>
	<br>
	<div class="row">
		<p class="wrapper mx-auto text-center w-100">
			OpenSauce is an online party game inspired by PopSauce implementing categories and that is not meant to crash.<br><br>
		</p>
	</div>
	<hr>
	<div class="row">
		<div class="col-md-8 col-sm-12">
			<div>
				<p class="h4 opensauce">Public lobbies
					<span style="float:right;">
					<a role="button" id="refreshLobbies" href="#" class="btn btn-dark">
						<i class="fas fa-sync-alt"></i>
					</a>
					</span>
				</p>
				<br>
				<div id="noLobbies"hidden>
					<div class="alert alert-dark" role="alert">
							There is currently no active lobby ! Feel free to create one.
					</div>
				</div>
				<div class="list-group" id="lobbiesList"></div>
			</div>
			<br>
			<div>
				<br>
				<p class="h4 opensauce">Create a lobby</p>
				<br>
				<div class="input-group">
					<div class="input-group-prepend">
						<span class="input-group-text">Lobby name</span>
					</div>
					<input id="input_lobby_name" type="text" class="form-control">
					<div class="input-group-append">
						<a href="#" id="create_lobby_button" role="button" class="btn btn-dark"><span>Create</span></a>
					</div>
				</div>
			</div>
		</div>
		<div class="col-md-4 col-sm-12">
			<p class="h4 opensauce">Find players on <a role="button" href="https://discord.gg/zXFjYaz" class="btn btn-outline-dark btn-sm"><i class="fab fa-discord"></i> Discord</a></small>
			<br><br>
			<iframe class="center" src="https://canary.discordapp.com/widget?id=552925373235462381&theme=light" width="100%" height="500" allowtransparency="true" frameborder="0"></iframe>
			</p>
		</div>
	</div>
	<hr>
	<div class="row">
		<div class="col-md-3 col-sm-12">
		</div>
		<div class="col-md-6 col-sm-12">
			<div class="btn-group" role="group" aria-label="Basic example">
				<a role="button" href="#" class="btn btn-outline-dark"><i class="fab fa-github"></i> Fork us on GitHub</a>
				<!--<a role="button" href="#" class="btn btn-outline-dark blue"><i class="fab fa-facebook-f"></i> Like our Facebook page</a>-->
				<a role="button" href="https://discord.gg/zXFjYaz" class="btn btn-dark"><i class="fab fa-discord"></i> Join us on Discord</a>
				<a role="button" href="https://twitter.com/OpenSauceApp" class="btn btn-primary"><i class="fab fa-twitter-square"></i> Follow us on Twitter</a>
			</div>
		</div>
		<div class="col-md-3 col-sm-12">

		</div>
	</div>
</div>
<script>
	$(document).ready(function(){
		let create_lobby_button = document.getElementById("create_lobby_button");
		create_lobby_button.disabled =  true;
		create_lobby_button.classList.remove('btn-dark');
		create_lobby_button.classList.add('btn-outline-dark', 'disabled');
		$('#input_lobby_name').keyup(function(event){
			if($(this).val().length !=0){
				create_lobby_button.disabled = false;
				create_lobby_button.classList.remove('btn-outline-dark', 'disabled');
				create_lobby_button.classList.add('btn-dark');
			}
			else
			{
				create_lobby_button.disabled = true;
				create_lobby_button.classList.remove('btn-dark');
				create_lobby_button.classList.add('btn-outline-dark', 'disabled');
			}
			console.log(create_lobby_button.disabled);
			if(event.keyCode == 13 && !create_lobby_button.disabled){
				console.log("go !");
				$("#create_lobby_button").find('span').trigger('click');
			}
		})
	});

	let lobbiesList = document.getElementById("lobbiesList");
	let refreshLobbies = document.getElementById("refreshLobbies");
	let noLobbies = document.getElementById("noLobbies");
	let create_lobby_button = document.getElementById("create_lobby_button");
	let input_lobby_name = document.getElementById("input_lobby_name");

	refreshLobbies.addEventListener("click", updateLobbiesList);
	input_lobby_name.addEventListener("change", updateLinkToLobby);

	updateLobbiesList();

	//autorefresh
	setInterval(updateLobbiesList, 1000);

	function updateLinkToLobby(e) {

		create_lobby_button.href = "lobby/" + e.srcElement.value;
	}

	function updateLobbiesList() {
		fetch("{% url 'lobbies_list' %}")
			.then(function(response) {
				return response.json();
			})
			.then(function(json) {
				lobbiesList.innerHTML = "";
				if (json.list.length <= 0) {
					noLobbies.hidden = false;
				} else {
					for (let i = 0; i < json.list.length; i++) {
						let lobby = json.list[i];
						let lobbyLink = document.createElement("a");
						lobbyLink.href = "lobby/" + lobby["name"];
						lobbyLink.type = "button";
						lobbyLink.classList. add("list-group-item", "list-group-item-action");
						lobbyLink.innerHTML += "<h4>" + lobby["players"] + " <i class=\"fas fa-running\"></i>" + " " + lobby["spectators"] + " <i class=\"fas fa-eye\"></i>" + " | " + lobby["name"] + "</h4>";
						lobbiesList.appendChild(lobbyLink);
					}
					noLobbies.hidden = true;
				}
			});
	}
</script>
{% endblock %}
